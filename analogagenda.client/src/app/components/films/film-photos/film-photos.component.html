<div class="container">
  <div class="header">
    <div class="film-info" *ngIf="film">
      <h1>{{ (film.name?.trim() ? film.name + ' - ' + film.brand : film.brand) }} - {{ film.formattedExposureDate || 'Photos' }}</h1>
      <p class="film-details">{{ film.type }} ‚Ä¢ ISO {{ film.iso }}</p>
    </div>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading photos...</p>
  </div>

  <div *ngIf="!loading && photos.length === 0" class="no-photos">
    <div class="no-photos-icon">üì∑</div>
    <p>No photos found for this film.</p>
    <div *ngIf="uploadLoading && uploadProgress.total > 0" class="upload-progress">
      Uploading photo {{ uploadProgress.current }} of {{ uploadProgress.total }}
    </div>
    <button class="add-photos-btn" [disabled]="uploadLoading" (click)="onUploadPhotos()">
      <span class="button-content" [class.loading]="uploadLoading">
        üì∏ Add Photos
      </span>
      <svg *ngIf="uploadLoading" class="button-spinner" viewBox="0 0 24 24">
        <circle class="spinner-bg" cx="12" cy="12" r="10" stroke-width="4"></circle>
        <path class="spinner-path" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
    </button>
    <p>Use the browser back button to return.</p>
  </div>

  <div *ngIf="!loading && photos.length > 0" class="photos-content">
    <div class="actions-bar">
      <div class="photos-count">
        <div *ngIf="uploadLoading && uploadProgress.total > 0" class="upload-progress">
          Uploading photo {{ uploadProgress.current }} of {{ uploadProgress.total }}
        </div>
        <div *ngIf="!uploadLoading || uploadProgress.total === 0">
          {{ photos.length }} photo{{ photos.length !== 1 ? 's' : '' }}
        </div>
      </div>
      <div class="action-buttons">
        <button class="add-photos-btn" [disabled]="uploadLoading" (click)="onUploadPhotos()">
          <span class="button-content" [class.loading]="uploadLoading">
            üì∏ Add Photos
          </span>
          <svg *ngIf="uploadLoading" class="button-spinner" viewBox="0 0 24 24">
            <circle class="spinner-bg" cx="12" cy="12" r="10" stroke-width="4"></circle>
            <path class="spinner-path" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
          </svg>
        </button>
        <div class="download-dropdown-container">
          <button class="download-all-btn" [disabled]="downloadAllLoading" (click)="toggleDownloadDropdown()">
            <span class="button-content" [class.loading]="downloadAllLoading">
              üì¶ Download
            </span>
            <span class="dropdown-arrow">‚ñº</span>
            <svg *ngIf="downloadAllLoading" class="button-spinner" viewBox="0 0 24 24">
              <circle class="spinner-bg" cx="12" cy="12" r="10" stroke-width="4"></circle>
              <path class="spinner-path" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
            </svg>
          </button>
          <div class="download-dropdown-menu" *ngIf="downloadDropdownOpen && !downloadAllLoading">
            <button class="dropdown-item" (click)="downloadAllPhotos(false)">
              üì¶ Download All XL
            </button>
            <button class="dropdown-item" (click)="downloadAllPhotos(true)">
              üì¶ Download All XS
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="photos-grid">
      <div 
        *ngFor="let photo of photos" 
        class="photo-item"
        (click)="openPreview(photo)"
      >
        <div class="photo-thumbnail">
          <img [src]="photoService.getPreviewUrl(photo)" [alt]="'Photo ' + photo.index" />
        </div>
        <div class="photo-info">
          <span class="photo-index">#{{ photo.index.toString().padStart(3, '0') }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Preview Modal -->
  <div class="image-preview-overlay" *ngIf="isPreviewModalOpen" (click)="closePreview()" (keydown)="onKeyDown($event)" tabindex="0">
    <div class="preview-content" (click)="$event.stopPropagation()" (touchstart)="onTouchStart($event)" (touchend)="onTouchEnd($event)">
      <!-- Previous Photo Arrow -->
      <button 
        class="nav-arrow prev-arrow" 
        (click)="previousPhoto()" 
        *ngIf="canNavigatePrevious()"
        title="Previous photo"
      >
        &#8249;
      </button>
      
      <!-- Next Photo Arrow -->
      <button 
        class="nav-arrow next-arrow" 
        (click)="nextPhoto()" 
        *ngIf="canNavigateNext()"
        title="Next photo"
      >
        &#8250;
      </button>

      <img 
        *ngIf="currentPreviewPhoto" 
        [src]="photoService.getPreviewUrl(currentPreviewPhoto!)" 
        [alt]="'Photo ' + currentPreviewPhoto.index" 
      />
      <div class="preview-actions">
        <button 
          class="preview-action-btn download-preview-btn" 
          (click)="downloadPhoto(currentPreviewPhoto!)"
          *ngIf="currentPreviewPhoto"
        >
          üì• Download
        </button>
        <button 
          class="preview-action-btn delete-btn" 
          (click)="openDeleteModal()"
          *ngIf="currentPreviewPhoto"
        >
          üóëÔ∏è Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="delete-modal-overlay" *ngIf="isDeleteModalOpen" (click)="closeDeleteModal()">
    <div class="delete-modal" (click)="$event.stopPropagation()">
      <h2>Confirm Delete</h2>
      <p *ngIf="currentPreviewPhoto">
        Are you sure you want to delete photo <strong>#{{ currentPreviewPhoto.index.toString().padStart(3, '0') }}</strong>?
      </p>
      <div class="delete-modal-actions">
        <button class="cancel-btn" (click)="closeDeleteModal()">Cancel</button>
        <button class="delete-confirm-btn" (click)="confirmDelete()">Delete</button>
      </div>
    </div>
  </div>
</div>
