<div>
    <!-- Title -->
    <div class="note-header">
        <input *ngIf="isEditMode" [(ngModel)]="note.name" class="note-title-input" placeholder="Enter note name" />
        <h1 *ngIf="!isEditMode" class="note-title">{{ note.name || 'Untitled Note' }}</h1>
    </div>

    <!-- Table Wrapper -->
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Time (min)</th>
                    <th>Process</th>
                    <th>Film</th>
                    <th>Details</th>
                    <th *ngIf="isEditMode">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let entry of note.entries; let i = index">
                    <td data-label="Time (min)">
                        <input *ngIf="isEditMode" type="number" [(ngModel)]="entry.time"
                            (change)="onTimeChange(i, entry.time)" />
                        <span *ngIf="!isEditMode">{{ entry.time }}m</span>
                    </td>
                    <td data-label="Process">
                        <input *ngIf="isEditMode" [(ngModel)]="entry.process" />
                        <span *ngIf="!isEditMode">{{ entry.process }}</span>
                    </td>
                    <td data-label="Film">
                        <input *ngIf="isEditMode" [(ngModel)]="entry.film" />
                        <span *ngIf="!isEditMode">{{ entry.film }}</span>
                    </td>
                    <td data-label="Details">
                        <input *ngIf="isEditMode" [(ngModel)]="entry.details" />
                        <span *ngIf="!isEditMode">{{ entry.details }}</span>
                    </td>
                    <td *ngIf="isEditMode" data-label="Actions" class="row-action-btns">
                        <button class="remove-btn" (click)="removeRow(i)"> <svg xmlns="http://www.w3.org/2000/svg"
                                width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path
                                    d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z" />
                                <path
                                    d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z" />
                            </svg></button>

                        <button class="copy-btn" (click)="copyRow(i)"> <svg xmlns="http://www.w3.org/2000/svg"
                                width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path fill-rule="evenodd"
                                    d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z" />
                            </svg></button>
                    </td>
                </tr>
            </tbody>
        </table>
        <button *ngIf="isEditMode" class="btn-add" (click)="addRow()">Add Row</button>
    </div>

    <div class="form-wrapper">
        <div class="form-row">

            <!-- Side Notes -->
            <div class="textarea-group">
                <label for="sideNotes">Side Notes</label>
                <textarea [readonly]="!isEditMode" id="sideNotes" [(ngModel)]="this.note.sideNote"
                    placeholder="Enter your notes here..." required></textarea>
            </div>

            <!-- Image Upload -->
            <div *ngIf="isEditMode" class="file-upload-group">
                <label for="fileInput">Thumbnail</label>
                <label class="file-square-zone">
                    <p *ngIf="!selectedFileName">+</p>
                    <p *ngIf="selectedFileName" class="file-name">{{ selectedFileName }}</p>
                    <input type="file" id="fileInput" (change)="onFileSelected($event)" />
                </label>
            </div>

            <!-- Preview Image -->
            <div *ngIf="!isEditMode" class="file-upload-group">
                <label for="previewButton">Preview Image</label>
                <label class="file-square-zone" (click)="this.isPreviewModalOpen = true">
                    <svg xmlns="http://www.w3.org/2000/svg" class="eye-icon" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M1.5 12s4.5-7.5 10.5-7.5S22.5 12 22.5 12s-4.5 7.5-10.5 7.5S1.5 12 1.5 12z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                </label>
            </div>

            <!-- Modal Overlay -->
            <div class="image-preview-overlay" *ngIf="isPreviewModalOpen" (click)="this.isPreviewModalOpen = false">
                <div class="image-preview-content" (click)="$event.stopPropagation()">
                    <img [src]="this.note.imageUrl" alt="Preview" />
                    <button class="close-btn" (click)="this.isPreviewModalOpen = false">âœ–</button>
                </div>
            </div>

        </div>
    </div>


    <!-- Footer Actions -->
    <div class="actions">
        <button *ngIf="!isEditMode" class="btn-edit" (click)="toggleEditMode()">Edit</button>
        <button *ngIf="!isNewNote && !isEditMode" class="delete-btn" (click)="isDeleteModalOpen = true">Delete</button>

        <ng-container *ngIf="isEditMode">
            <button class="btn-primary" (click)="saveNote()">Save</button>
            <button class="btn-ghost" (click)="discardChanges()">Discard</button>
        </ng-container>
    </div>

    <div class="delete-modal-overlay" *ngIf="isDeleteModalOpen" (click)="isDeleteModalOpen = false">
        <div class="delete-modal" (click)="$event.stopPropagation()">
            <h2>Confirm Delete</h2>
            <p>
                Are you sure you want to delete <strong>{{ this.originalNote?.name }}</strong> Note?
            </p>
            <div class="delete-modal-actions">
                <button class="cancel-btn" (click)="isDeleteModalOpen = false">Cancel</button>
                <button class="delete-btn" (click)="onDelete()">Delete</button>
            </div>
        </div>
    </div>
</div>