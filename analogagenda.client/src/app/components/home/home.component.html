<div class="home-container">
    <div class="sections-row">
        <app-film-check-section></app-film-check-section>

        <app-current-film-section
            [userSettings]="userSettings"
            [currentFilm]="currentFilm"
            (changeCurrentFilmRequested)="openChangeCurrentFilmModal()">
        </app-current-film-section>

        <app-settings-section
            [userSettings]="userSettings"
            (settingsUpdated)="loadUserSettings()">
        </app-settings-section>

        <app-wacky-ideas-section
            (addIdea)="openAddIdeaModal()"
            (editIdea)="openEditIdeaModal($event)"
            #wackyIdeasSection>
        </app-wacky-ideas-section>
    </div>

    <!-- Change Current Film Modal -->
    <div class="modal-overlay" *ngIf="isChangeCurrentFilmModalOpen" (click)="closeChangeCurrentFilmModal()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <div></div>
                <h3>Change Current Film</h3>
                <button class="modal-close" (click)="closeChangeCurrentFilmModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="film-list">
                    <div 
                        *ngFor="let film of availableFilms" 
                        class="film-item"
                        [class.selected]="selectedFilmId === film.id"
                        (click)="selectedFilmId = film.id">
                        <div class="film-item-info">
                            <div class="film-name">{{ film.name || film.brand }}</div>
                            <div class="film-details">
                                <span>ISO: {{ film.iso }}</span>
                                <span>Type: {{ film.type }}</span>
                            </div>
                        </div>
                        <img class="film-item-image" [src]="film.imageUrl" [alt]="film.name || film.brand" />
                    </div>
                    <div *ngIf="availableFilms.length === 0" class="no-films">
                        No not-developed films available
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button 
                    class="btn btn-primary" 
                    (click)="changeCurrentFilm()"
                    [disabled]="!selectedFilmId">
                    Save
                </button>
                <button class="btn btn-secondary" (click)="closeChangeCurrentFilmModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Upsert Idea Modal -->
    <div class="modal-overlay" *ngIf="isUpsertIdeaModalOpen"
        (mousedown)="onUpsertIdeaOverlayMouseDown($event)"
        (mouseup)="onUpsertIdeaOverlayMouseUp($event)">
        <div class="modal-content" (mousedown)="onUpsertIdeaModalContentMouseDown()">
            <div class="modal-header">
                <div></div>
                <h3>{{ selectedIdea ? 'Edit Idea' : 'Add Idea' }}</h3>
                <button class="modal-close" (click)="closeUpsertIdeaModal()">✕</button>
            </div>
            <div class="modal-body">
                <app-upsert-idea
                    [idea]="selectedIdea"
                    (saved)="onIdeaSaved()"
                    (deleted)="onIdeaDeleted()">
                </app-upsert-idea>
            </div>
        </div>
    </div>
</div>
